CREATE DATABASE Restaurante;

USE Restaurante;

CREATE TABLE SUCURSAL(
    ID_SUCURSAL VARCHAR(3) NOT NULL,
    NOMBRE_SUCURSAL VARCHAR(45) NOT NULL,
    DIRECCION VARCHAR(100) NOT NULL,
    TELEFONO_SUCURSAL INT NOT NULL,
    SALDO NUMERIC(10,2) NOT NULL,
    ID_SUCURSAL_CARGO VARCHAR(3) NOT NULL,

    CONSTRAINT PK_SUCURSAL PRIMARY KEY(ID_SUCURSAL),

    CONSTRAINT FK1_SUCURSAL FOREIGN KEY (ID_SUCURSAL_CARGO)
        REFERENCES SUCURSAL (ID_SUCURSAL)
);

CREATE TABLE CARGO(
    ID_CARGO VARCHAR(3) NOT NULL,
    NOMBRE_CARGO VARCHAR(45) NOT NULL,

    CONSTRAINT PK_CARGO PRIMARY KEY(ID_CARGO)
);

CREATE TABLE EMPLEADO(
	ID_EMPLEADO VARCHAR(8) NOT NULL,
	NOMBRES_EMPLEADO VARCHAR(45) NOT NULL,
	APELLIDOS_EMPLEADO VARCHAR(45) NOT NULL,
	DIRECCION VARCHAR(100) NOT NULL,
    TELEFONO_EMPLEADO INT NULL,
    NACIMIENTO DATETIME NOT NULL,
    CORREO VARCHAR(45) NULL,
    SALARIO NUMERIC(6,2) NOT NULL,

    ID_SUCURSAL VARCHAR(3) NOT NULL,
    ID_CARGO VARCHAR(3) NOT NULL,

    CONSTRAINT PK_EMPLEADO PRIMARY KEY(ID_EMPLEADO),

    CONSTRAINT FK1_EMPLEADO FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
        ON DELETE NO ACTION
        ON UPDATE CASCADE,
    CONSTRAINT FK2_EMPLEADO FOREIGN KEY (ID_CARGO)
        REFERENCES CARGO (ID_CARGO)
        ON DELETE NO ACTION
        ON UPDATE CASCADE,
);

CREATE TABLE REGISTRO_JORNADA(
    HORA_ENTRADA DATETIME NULL,
    HORA_SALIDA DATETIME NULL,

    ID_EMPLEADO VARCHAR(8) NOT NULL,

    CONSTRAINT PK_REGISTRO_JORNADA PRIMARY KEY(ID_EMPLEADO),

    CONSTRAINT FK1_REGISTRO_JORNADA FOREIGN KEY (ID_EMPLEADO)
        REFERENCES EMPLEADO (ID_EMPLEADO)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);


CREATE TABLE MESA(
    ID_MESA VARCHAR(3) NOT NULL,
    ESTADO BIT DEFAULT 0,
    CAPACIDAD INT NOT NULL,

    ID_SUCURSAL VARCHAR(3) NOT NULL, 

    CONSTRAINT PK_MESA PRIMARY KEY(ID_MESA),

    CONSTRAINT FK1_MESA FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
        ON DELETE NO ACTION
        ON UPDATE CASCADE
);

CREATE TABLE PROVEEDOR(
    ID_PROVEEDOR VARCHAR(3) NOT NULL,
    NOMBRE_PROVEEDOR VARCHAR(45) NULL,
    NOMBRE_EMPRESA VARCHAR(45) NOT NULL,
    TELEFONO_PROVEEDOR INT NULL,

    CONSTRAINT PK_PROVEEDOR PRIMARY KEY(ID_PROVEEDOR)
);

CREATE TABLE TIPO_INSUMO(
	ID_TIPO_INSUMO VARCHAR(3) NOT NULL,
	NOMBRE_TIPO_INSUMO VARCHAR(45) NOT NULL,

	CONSTRAINT PK_TIPO_INSUMO PRIMARY KEY(ID_TIPO_INSUMO)
);

CREATE TABLE INSUMO(
    ID_INSUMO VARCHAR(3) NOT NULL,
    NOMBRE_INSUMO VARCHAR(45) NOT NULL,
    MARCA VARCHAR(45) NULL,

    ID_PROVEEDOR VARCHAR(3) NOT NULL,
    ID_TIPO_INSUMO VARCHAR(3) NOT NULL,

    CONSTRAINT PK_INSUMO PRIMARY KEY(ID_INSUMO),

    CONSTRAINT FK1_INSUMO FOREIGN KEY (ID_PROVEEDOR)
        REFERENCES PROVEEDOR (ID_PROVEEDOR)
        ON DELETE NO ACTION
        ON UPDATE CASCADE,
    CONSTRAINT FK2_INSUMO FOREIGN KEY (ID_TIPO_INSUMO)
        REFERENCES TIPO_INSUMO (ID_TIPO_INSUMO)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);


CREATE TABLE PEDIDO(
    ID_PEDIDO INT IDENTITY(1,1) NOT NULL,
    FECHA_PEDIDO DATETIME NOT NULL,
    CANTIDAD_PEDIDO INT NOT NULL,
    OBSERVACIONES VARCHAR(45) NULL,

    PRECIO_INSUMO NUMERIC(6,2) NOT NULL,
    CANTIDAD_INSUMO INT NOT NULL,
    MEDIDA_INSUMO VARCHAR(5) NULL,

    ID_SUCURSAL VARCHAR(3) NOT NULL,
    ID_INSUMO VARCHAR(3) NOT NULL,

    CONSTRAINT PK_PEDIDO PRIMARY KEY(ID_PEDIDO,ID_INSUMO),

    CONSTRAINT FK1_PEDIDO FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
        ON DELETE NO ACTION
        ON UPDATE CASCADE,
    CONSTRAINT FK2_PEDIDO FOREIGN KEY (ID_INSUMO)
        REFERENCES INSUMO (ID_INSUMO)
        ON DELETE NO ACTION
        ON UPDATE CASCADE
);



CREATE TABLE SECCION(
    ID_SECCION INT IDENTITY(1,1) NOT NULL,
    NOMBRE_SECCION VARCHAR(45) NOT NULL,

    CONSTRAINT PK_SECCION PRIMARY KEY(ID_SECCION)
);


CREATE TABLE CATEGORIA(
    ID_CATEGORIA INT IDENTITY(1,1)  NOT NULL,
    NOMBRE_CATEGORIA VARCHAR(45) NOT NULL,
    ID_SECCION INT NOT NULL,

    CONSTRAINT PK_CATEGORIA PRIMARY KEY(ID_CATEGORIA),

    CONSTRAINT FK1_CATEGORIA FOREIGN KEY (ID_SECCION)
        REFERENCES SECCION (ID_SECCION)
);


CREATE TABLE PRODUCTO(
    ID_PRODUCTO INT IDENTITY(1,1) NOT NULL,
    NOMBRE_PRODUCTO VARCHAR(45) NOT NULL,
    PRECIO_PRODUCTO NUMERIC(5,2) NOT NULL,
    DESCRIPCION VARCHAR(100) NULL,

    ID_CATEGORIA INT NOT NULL,

    CONSTRAINT PK_PRODUCTO PRIMARY KEY(ID_PRODUCTO),

    CONSTRAINT FK1_PRODUCTO FOREIGN KEY (ID_CATEGORIA)
        REFERENCES CATEGORIA (ID_CATEGORIA)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);


CREATE TABLE ORDEN(
    ID_ORDEN INT IDENTITY(1,1) NOT NULL,

    ID_MESA VARCHAR(3) NOT NULL,
    ID_EMPLEADO VARCHAR(8) NOT NULL,
    ID_SUCURSAL VARCHAR(3) NOT NULL,

    CONSTRAINT PK_ORDEN PRIMARY KEY(ID_ORDEN),

    CONSTRAINT FK1_ORDEN FOREIGN KEY (ID_MESA)
        REFERENCES MESA (ID_MESA),
    CONSTRAINT FK2_ORDEN FOREIGN KEY (ID_EMPLEADO)
        REFERENCES EMPLEADO (ID_EMPLEADO),
    CONSTRAINT FK3_ORDEN FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
);


CREATE TABLE ORD_PROD(
    CANTIDAD_PROD INT NOT NULL,

    ID_ORDEN INT NOT NULL,
    ID_PRODUCTO INT NOT NULL,

    CONSTRAINT PK_ORD_PROD PRIMARY KEY(ID_ORDEN, ID_PRODUCTO),

    CONSTRAINT FK1_ORD_PROD FOREIGN KEY (ID_ORDEN)
        REFERENCES ORDEN (ID_ORDEN)
        ON DELETE CASCADE
        ON UPDATE CASCADE,
    CONSTRAINT FK2_ORD_PROD FOREIGN KEY (ID_PRODUCTO)
        REFERENCES PRODUCTO (ID_PRODUCTO)
        ON DELETE CASCADE
        ON UPDATE CASCADE
);


CREATE TABLE CLIENTE(
    ID_CLIENTE INT IDENTITY(1,1) NOT NULL,
    NOMBRES_CLIENTE VARCHAR(45) NOT NULL,
    APELLIDOS_CLIENTE VARCHAR(45) NULL,
    TELEFONO_CLIENTE INT NOT NULL,

    CONSTRAINT PK_CLIENTE PRIMARY KEY(ID_CLIENTE)
);


CREATE TABLE RESERVACION(
    ID_RESERVACION INT IDENTITY(1,1) NOT NULL,
    FECHA_RESERVACION DATETIME NOT NULL,

    ID_CLIENTE INT NOT NULL,
    ID_MESA VARCHAR(3) NOT NULL,
    ID_SUCURSAL VARCHAR(3) NOT NULL,

    CONSTRAINT PK_RESERVACION PRIMARY KEY(ID_RESERVACION),

    CONSTRAINT FK1_RESERVACION FOREIGN KEY (ID_CLIENTE)
        REFERENCES CLIENTE (ID_CLIENTE),
    CONSTRAINT FK2_RESERVACION FOREIGN KEY (ID_MESA)
        REFERENCES MESA (ID_MESA),
    CONSTRAINT FK3_RESERVACION FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
);


CREATE TABLE BANCO(
    ID_BANCO INT IDENTITY(1,1) NOT NULL,
    NOMBRE_BANCO VARCHAR(45) NOT NULL,

    CONSTRAINT PK_BANCO PRIMARY KEY(ID_BANCO)
);

CREATE TABLE FACTURA(
    ID_FACTURA INT IDENTITY(1,1) NOT NULL,
    FECHA_FACTURA DATETIME NOT NULL,
    TOTAL NUMERIC(10,2) NOT NULL,
    IGV INT NOT NULL,
    FORMA_PAGO VARCHAR(45) NOT NULL,

    ID_ORDEN INT NOT NULL,
    ID_SUCURSAL VARCHAR(3) NOT NULL,

    CONSTRAINT PK_FACTURA PRIMARY KEY(ID_FACTURA),

    CONSTRAINT FK1_FACTURA FOREIGN KEY (ID_ORDEN)
        REFERENCES ORDEN (ID_ORDEN),
    CONSTRAINT FK2_FACTURA FOREIGN KEY (ID_SUCURSAL)
        REFERENCES SUCURSAL (ID_SUCURSAL)
);

CREATE TABLE TRANSACCION(
    NUMERO_TRANS INT NOT NULL,
    MONEDA VARCHAR(45) NOT NULL,

    ID_BANCO INT NOT NULL,
    ID_FACTURA INT NOT NULL,

    CONSTRAINT PK_TARJETA PRIMARY KEY(NUMERO_TRANS,ID_FACTURA),

    CONSTRAINT FK1_TARJETA FOREIGN KEY (ID_FACTURA)
        REFERENCES FACTURA (ID_FACTURA)
        ON DELETE NO ACTION
        ON UPDATE CASCADE,
    CONSTRAINT FK2_TARJETA FOREIGN KEY (ID_BANCO)
        REFERENCES BANCO (ID_BANCO)
        ON DELETE NO ACTION
        ON UPDATE CASCADE
);


